@inherits LayoutComponentBase
@inject AuthenticationStateProvider authProvider

<MudThemeProvider />
<MudDialogProvider />
<MudSnackbarProvider />
<MudLayout>
    <MudAppBar Elevation="1">
        <MudIconButton Href="/profile" Edge="Edge.Start" Variant="Variant.Text" Color="Color.Inherit" Icon="@Icons.Material.Outlined.Person"/>
        <AuthorizeView>
            <Authorized>
                <MudText Class="ml-2" Typo="Typo.body1">@context.User.Identity.Name</MudText>
                <MudSpacer/>
                <MudIconButton OnClick="SignOut" Variant="Variant.Text" Color="Color.Inherit" Icon="@Icons.Material.Outlined.Logout" />
            </Authorized>
            <NotAuthorized>
                <MudText Class="ml-2" @onclick="@(()=> nav.NavigateTo("/"))" Typo="Typo.body1">Home</MudText>
            </NotAuthorized>
        </AuthorizeView>
        <MudSpacer />
    </MudAppBar>
    <MudMainContent>
        <MudContainer Class="pt-3" MaxWidth="MaxWidth.ExtraLarge">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>
@code{
    private async Task SignOut()
    {
        var token = await SecureStorage.Default.GetAsync("bearerToken");

        if (!string.IsNullOrEmpty(token))
        {
            SecureStorage.Default.Remove("bearerToken");
            ((AppAuthenticationStateProvider)authProvider).SignOut();
        }
        StateHasChanged();
        nav.NavigateTo("/");
    }
}